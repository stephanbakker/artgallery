var gallery=function(a){return"use strict",a.createCollection=function(){var b=a.$root.find("a"),c=b&&b.length,d,e,f=[],g={};return b.each(function(a){var b=$(this);b.data("id",a),f.push({$img:this.href,$title:this.title,$description:b.data("description"),$index:a+1,$thumb:b.find("img")[0].src})}),c=b.length,g.count=c,g.all=function(){return f},g.get=function(a){return f[a]},g.set=function(a){return d=a<0?0:a>c-1?c-1:a,this.get(d)},g.next=function(){return this.get(d+1)},g.setnext=function(){return this.set(d+1)},g.previous=function(){return this.get(d-1)},g.setprevious=function(){return this.set(d-1)},g},a}(gallery||{}),gallery=function(a){return"use strict",a.prepareGallery=function(b,c){function s(a){var b=/\n/gm;return typeof a=="string"?a.replace(b,"<br>"):a}function t(a,b){var c=/\$\w+/gim;return a.replace(c,function(a){return a==="$description"?s(b[a]):b[a]||""})}function u(b){b&&(b.$indexof=b.$index+"/"+p,$(t(e,b)).appendTo(a.$slides))}function v(){var b;a.slidesWidth=(window.innerWidth||document.documentElement.clientWidth)-20,h=$(t(d)),a.$slides=h.find(".galslider"),j=h.find(".galslides");for(b=0;b<p;b++)u(o[b]);h.appendTo(f)}function w(a){a.$index<=1?h.addClass("galnoprevious"):h.removeClass("galnoprevious"),a.$index>=p?h.addClass("galnonext"):h.removeClass("galnonext")}function x(){m&&clearTimeout(m),h.addClass("galhidecaption"),m=setTimeout(function(){h.removeClass("galhidecaption")},500)}function y(a){var b,c;a.hasClass("galpending")&&(b=$("<img />"),c=a.find("img").first(),a.addClass("galloading"),b.load(function(){c.attr("src",c.data("img")),a.removeClass("galloading galpending"),b=null}).attr("src",c.data("img")))}function z(a){var b=a.$index,c=[-1,1,0],d=c.length,e,f;while(d--)e=$("#galimg_"+(b-c[d])),y(e)}function A(){$("."+g).removeClass(g)}function B(a){A(),$("#galimg_"+a).addClass(g)}var d=b?document.getElementById(b).innerHTML:"",e=c?document.getElementById(c).innerHTML:"",f=$("body"),g="galslideCur",h,i,j,k,l,m,n=a.collection,o=a.collection.all(),p=a.collection.count,q=Modernizr.csstransforms3d,r={};return r.moveTo=function(b){return q?function(b){a.$slides[0].style.MozTransform=a.$slides[0].style.webkitTransform="translate3d("+b+"px, 0, 0)",a.curpos=b}:function(b){a.$slides.css({"margin-left":b+"px"}),a.curpos=b}}(),r.showSlide=function(b){w(b);var c=-(b.$index-1)*a.slidesWidth;x(),r.moveTo(c),z(b),B(b.$index),a.curItem=b},a.updateGalSizes=function(){var b=j.innerHeight();a.slidesWidth=(window.innerWidth||document.documentElement.clientWidth)-20,i&&i.remove(),i=$('<style type="text/css">.galslider .galslide {width: '+a.slidesWidth+"px;height: "+b+"px}</style>").appendTo($("head"))},r.start=function(b){if($.isPlainObject(b)){var c;h?h.addClass("galhidden"):v(),a.updateGalSizes(),r.showSlide(b),h.removeClass("galhidden"),f.addClass("galactive")}},r.end=function(){h&&(h.remove(),h=null),a.$slides&&delete a.$slides,f.removeClass("galactive"),a.removeGalEvents()},r.previous=function(){var a=n.setprevious();r.showSlide(a)},r.next=function(){var a=n.setnext();r.showSlide(a)},r},a}(gallery||{}),gallery=function(a){function g(b){b.preventDefault();var c=$(b.currentTarget);c.hasClass("galnext")?a.controls.next():c.hasClass("galprevious")?a.controls.previous():c.hasClass("galclose")?(a.controls.end(),a.fullscreen.exit()):d&&c.hasClass("galfullscreen-enter")?a.fullscreen.enter(function(){a.updateGalSizes(),c.removeClass("galfullscreen-enter").addClass("galfullscreen-exit")}):d&&c.hasClass("galfullscreen-exit")&&(a.updateGalSizes(),a.fullscreen.exit(function(){c.removeClass("galfullscreen-exit").addClass("galfullscreen-enter")}))}function h(b){var c=b.keyCode||b.which;switch(c){case f.left:a.controls.previous();break;case f.right:a.controls.next();break;case f.escape:a.controls.end();break;default:}}function i(b){var c=b.type;typeof a.drag[c]=="function"&&a.drag[c](b.originalEvent,b.currentTarget,a.controls)}function j(b){e&&clearTimeout(e),e=setTimeout(function(){if(!a.$slides)return;a.updateGalSizes(),a.curItem&&a.controls.showSlide(a.curItem)},200)}"use strict";var b=$("body"),c=a.$root,d=!1,e,f={left:37,right:39,escape:27};return a.initGalEvents=function(){$("body").on("click",".galcontrol",g).on("keydown",h),Modernizr.touch&&b.on("touchstart touchmove touchend",".galslides",i),$(window).on("resize",j)},a.removeGalEvents=function(){b.off("click",".galcontrol",g).off("keydown",h),Modernizr.touch&&b.off("touchstart touchmove touchend",".galslides",i),$(window).off("resize",j)},a.initLaunchEvent=function(){var c=a.collection,e=window.document.documentElement;if(e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen)d=!0,$("html").addClass("fullscreen");b.on("click",".gal a",function(b){b.preventDefault();var d=$(this).data("id");a.controls.start(c.set(d)),a.initGalEvents()})},a}(gallery||{}),gallery=function(a){return"use strict",a.fullscreen={enter:function(){var a=window.document.documentElement;return function(b){if(a.requestFullscreen)a.requestFullscreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else if(a.webkitRequestFullScreen)a.webkitRequestFullScreen();else return!1;typeof b=="function"&&b()}}(),exit:function(){var a=window.document;return function(b){if(a.exitFullscreen)a.exitFullscreen();else if(a.mozCancelFullScreen)a.mozCancelFullScreen();else if(a.webkitCancelFullScreen)a.webkitCancelFullScreen();else return!1;typeof b=="function"&&b()}}()},a}(gallery||{}),gallery=function(a){return"use strict",a.init=function(b,c,d){a.$root=d||$(".gal");if(!$){window.console&&console.log("needs jquery");return}a.collection=a.createCollection(),a.controls=a.prepareGallery(b,c),a.initLaunchEvent()},a}(gallery||{}),gallery=function(a){return"use strict",a.drag={touchstart:function(b,c){b.preventDefault(),this.startx=b.touches[0].pageX,this.starty=b.touches[0].pageY,this.width=window.outerWidth-20,this.totalWidth=this.width*a.collection.count,this.minMove=this.width/5,this.startpos=a.curpos,this.sliding=!1,this.newx=null},touchmove:function(b,c){var d;if(b.touches.length>1||b.scale&&b.scale!==1){this.sliding=!1;return}this.curx=b.touches[0].pageX,d=this.curx-(this.newx||this.startx),this.sliding===!1&&(this.sliding=Math.abs(d)>this.starty-Math.abs(b.touches[0].pageY)),this.sliding&&(b.preventDefault(),a.$slides.addClass("galsliding"),a.controls.moveTo(a.curpos+d),this.newx=this.curx)},touchend:function(b,c,d){this.sliding=!1,this.newx=null,a.$slides.removeClass("galsliding");var e=this.startx-this.curx;Math.abs(e)>this.minMove?e<0?d.previous():e>0&&d.next():a.controls.moveTo(this.startpos)}},a}(gallery||{});