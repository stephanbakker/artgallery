var gallery=function(a){"use strict";return a.createCollection=function(){var b,c=a.$root.find("a"),d=c&&c.length,e=[],f={};return c.each(function(a){var b=$(this);b.data("id",a),e.push({$img:this.href,$title:this.title,$description:b.data("description"),$index:a+1,$thumb:b.find("img")[0].src})}),d=c.length,f.count=d,f.all=function(){return e},f.get=function(a){return e[a]},f.set=function(a){return b=0>a?0:a>d-1?d-1:a,this.get(b)},f.next=function(){return this.get(b+1)},f.setnext=function(){return this.set(b+1)},f.previous=function(){return this.get(b-1)},f.setprevious=function(){return this.set(b-1)},f},a}(gallery||{}),gallery=function(a){"use strict";return a.prepareGallery=function(b,c){function d(a){var b=/\n/gm;return"string"==typeof a?a.replace(b,"<br>"):a}function e(a,b){var c=/\$\w+/gim;return a.replace(c,function(a){return"$description"===a?d(b[a]):b[a]||""})}function f(b){b&&(b.$indexof=b.$index+"/"+x,$(e(s,b)).appendTo(a.$slides))}function g(){var b;for(a.slidesWidth=(window.innerWidth||document.documentElement.clientWidth)-20,n=$(e(r)),a.$slides=n.find(".galslider"),p=n.find(".galslides"),b=0;x>b;b++)f(w[b]);n.appendTo(t)}function h(a){a.$index<=1?n.addClass("galnoprevious"):n.removeClass("galnoprevious"),a.$index>=x?n.addClass("galnonext"):n.removeClass("galnonext")}function i(){q&&clearTimeout(q),n.addClass("galhidecaption"),q=setTimeout(function(){n.removeClass("galhidecaption")},500)}function j(a){var b,c;a.hasClass("galpending")&&(b=$("<img />"),c=a.find("img").first(),a.addClass("galloading"),b.load(function(){c.attr("src",c.data("img")),a.removeClass("galloading galpending"),b=null}).attr("src",c.data("img")))}function k(a){for(var b,c=a.$index,d=[-1,1,0],e=d.length;e--;)b=$("#galimg_"+(c-d[e])),j(b)}function l(){$("."+u).removeClass(u)}function m(a){l(),$("#galimg_"+a).addClass(u)}var n,o,p,q,r=b?document.getElementById(b).innerHTML:"",s=c?document.getElementById(c).innerHTML:"",t=$("body"),u="galslideCur",v=a.collection,w=a.collection.all(),x=a.collection.count,y=Modernizr.csstransforms3d,z={};return z.moveTo=function(){return y?function(b){a.$slides[0].style.MozTransform=a.$slides[0].style.webkitTransform=a.$slides[0].style.msTransform=a.$slides[0].style.transform="translate3d("+b+"px, 0, 0)",a.curpos=b}:function(b){a.$slides.css({"margin-left":b+"px"}),a.curpos=b}}(),z.showSlide=function(b){h(b);var c=-(b.$index-1)*a.slidesWidth;i(),z.moveTo(c),k(b),m(b.$index),a.curItem=b},a.updateGalSizes=function(){var b=p.innerHeight();a.slidesWidth=(window.innerWidth||document.documentElement.clientWidth)-20,o&&o.remove(),o=$('<style type="text/css">.galslider .galslide {width: '+a.slidesWidth+"px;height: "+b+"px}</style>").appendTo($("head"))},z.start=function(b){$.isPlainObject(b)&&(n?n.addClass("galhidden"):g(),a.updateGalSizes(),z.showSlide(b),n.removeClass("galhidden"),t.addClass("galactive"))},z.end=function(){n&&(n.remove(),n=null),a.$slides&&delete a.$slides,t.removeClass("galactive"),a.removeGalEvents()},z.previous=function(){var a=v.setprevious();z.showSlide(a)},z.next=function(){var a=v.setnext();z.showSlide(a)},z},a}(gallery||{}),gallery=function(a){"use strict";function b(b){b.preventDefault();var c=$(b.currentTarget);c.hasClass("galnext")?a.controls.next():c.hasClass("galprevious")?a.controls.previous():c.hasClass("galclose")?(a.controls.end(),a.fullscreen.exit()):h&&c.hasClass("galfullscreen-enter")?a.fullscreen.enter(function(){a.updateGalSizes(),c.removeClass("galfullscreen-enter").addClass("galfullscreen-exit")}):h&&c.hasClass("galfullscreen-exit")&&(a.updateGalSizes(),a.fullscreen.exit(function(){c.removeClass("galfullscreen-exit").addClass("galfullscreen-enter")}))}function c(b){var c=b.keyCode||b.which;switch(c){case i.left:a.controls.previous();break;case i.right:a.controls.next();break;case i.escape:a.controls.end()}}function d(b){var c=b.type;"function"==typeof a.drag[c]&&a.drag[c](b.originalEvent,b.currentTarget,a.controls)}function e(){f&&clearTimeout(f),f=setTimeout(function(){a.$slides&&(a.updateGalSizes(),a.curItem&&a.controls.showSlide(a.curItem))},200)}var f,g=$("body"),h=(a.$root,!1),i={left:37,right:39,escape:27};return a.initGalEvents=function(){$("body").on("click",".galcontrol",b).on("keydown",c),Modernizr.touch&&g.on("touchstart touchmove touchend",".galslides",d),$(window).on("resize",e)},a.removeGalEvents=function(){g.off("click",".galcontrol",b).off("keydown",c),Modernizr.touch&&g.off("touchstart touchmove touchend",".galslides",d),$(window).off("resize",e)},a.initLaunchEvent=function(){var b=a.collection,c=window.document.documentElement;(c.requestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullScreen)&&(h=!0,$("html").addClass("fullscreen")),g.on("click",".gal a",function(c){c.preventDefault();var d=$(this).data("id");a.controls.start(b.set(d)),a.initGalEvents()})},a}(gallery||{}),gallery=function(a){"use strict";return a.fullscreen={enter:function(){var a=window.document.documentElement;return function(b){if(a.requestFullscreen)a.requestFullscreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else{if(!a.webkitRequestFullScreen)return!1;a.webkitRequestFullScreen()}"function"==typeof b&&b()}}(),exit:function(){var a=window.document;return function(b){if(a.exitFullscreen)a.exitFullscreen();else if(a.mozCancelFullScreen)a.mozCancelFullScreen();else{if(!a.webkitCancelFullScreen)return!1;a.webkitCancelFullScreen()}"function"==typeof b&&b()}}()},a}(gallery||{}),gallery=function(a){"use strict";return a.init=function(b,c,d){return a.$root=d||$(".gal"),$?(a.collection=a.createCollection(),a.controls=a.prepareGallery(b,c),a.initLaunchEvent(),void 0):(window.console&&console.log("needs jquery"),void 0)},a}(gallery||{}),gallery=function(a){"use strict";return a.drag={touchstart:function(b){b.preventDefault(),this.startx=b.touches[0].pageX,this.starty=b.touches[0].pageY,this.width=window.outerWidth-20,this.totalWidth=this.width*a.collection.count,this.minMove=this.width/5,this.startpos=a.curpos,this.sliding=!1,this.newx=null},touchmove:function(b){var c;return b.touches.length>1||b.scale&&1!==b.scale?(this.sliding=!1,void 0):(this.curx=b.touches[0].pageX,c=this.curx-(this.newx||this.startx),this.sliding===!1&&(this.sliding=Math.abs(c)>this.starty-Math.abs(b.touches[0].pageY)),this.sliding&&(b.preventDefault(),a.$slides.addClass("galsliding"),a.controls.moveTo(a.curpos+c),this.newx=this.curx),void 0)},touchend:function(b,c,d){this.sliding=!1,this.newx=null,a.$slides.removeClass("galsliding");var e=this.startx-this.curx;Math.abs(e)>this.minMove?0>e?d.previous():e>0&&d.next():a.controls.moveTo(this.startpos)}},a}(gallery||{});